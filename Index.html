<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LR Paris Brief Tool</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }
        .btn-secondary:hover {
            background: #d1d5db;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 2px solid #f3f4f6;
            margin-bottom: 30px;
        }
        .mic-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .mic-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #9ca3af;
        }
        .mic-dot.active {
            background: #ef4444;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        .progress {
            color: #6b7280;
            font-size: 14px;
        }
        .question-box {
            margin: 30px 0;
        }
        .question-text {
            font-size: 22px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 20px;
        }
        .choices {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .choice-btn {
            padding: 10px 20px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
        }
        .choice-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        .choice-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-family: inherit;
            font-size: 15px;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        .hint {
            color: #9ca3af;
            font-size: 14px;
            font-style: italic;
            margin-bottom: 15px;
        }
        .complete-actions {
            display: grid;
            gap: 12px;
            margin-top: 30px;
        }
        .banner {
            background: #fef3c7;
            border: 1px solid #fde68a;
            color: #92400e;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Welcome Screen -->
        <div id="welcome" class="screen active">
            <h1>üéôÔ∏è LR Paris Brief Tool</h1>
            <p class="subtitle">Create product and packaging briefs with voice or text input</p>
            <button class="btn" onclick="startBrief()">Start New Brief</button>
            <p style="margin-top: 20px; color: #6b7280; font-size: 14px;">
                üí° Works best in Chrome, Edge, or Safari for voice recognition
            </p>
        </div>

        <!-- Questions Screen -->
        <div id="questions" class="screen">
            <div class="status-bar">
                <div class="mic-status">
                    <div class="mic-dot" id="micDot"></div>
                    <span id="micStatus">Mic Off</span>
                    <button class="btn btn-secondary" id="micBtn" onclick="toggleMic()" style="margin-left: 10px; padding: 8px 16px; font-size: 14px;">
                        Start Recording
                    </button>
                </div>
                <div class="progress" id="progress">Step 0 of 0</div>
            </div>

            <div id="bannerArea"></div>

            <div class="question-box">
                <div class="question-text" id="questionText"></div>
                <div class="choices" id="choicesArea"></div>
                <textarea id="answerInput" placeholder="Type or speak your answer..."></textarea>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" onclick="goBack()">‚Üê Back</button>
                <button class="btn btn-secondary" onclick="skipQuestion()">Skip</button>
                <button class="btn" id="nextBtn" onclick="goNext()" disabled>Next ‚Üí</button>
            </div>

            <p style="margin-top: 15px; color: #9ca3af; font-size: 13px;">
                üé§ Voice commands: "next", "back", "skip", "stop recording"
            </p>
        </div>

        <!-- Complete Screen -->
        <div id="complete" class="screen">
            <h1>‚úÖ Brief Complete!</h1>
            <p class="subtitle">Your brief has been captured successfully</p>
            <div class="complete-actions">
                <button class="btn" onclick="exportJSON()">üì• Download JSON</button>
                <button class="btn" onclick="exportPDF()">üìÑ Print/Save PDF</button>
                <button class="btn btn-secondary" onclick="startOver()">üîÑ Start Over</button>
            </div>
        </div>
    </div>

    <script>
        // State
        let state = {
            branch: [],
            packagingTypes: [],
            answers: [],
            queue: [],
            step: 0,
            startedAt: null
        };

        let recognition = null;
        let isListening = false;

        // Question Bank
        const QUESTIONS = {
            entry: {
                id: "entry",
                text: "What kind of brief are you creating?",
                type: "multi",
                options: ["Product", "Packaging"]
            },
            pkgTypes: {
                id: "pkgTypes",
                text: "Which packaging types?",
                type: "multi",
                options: ["Shopping Bag", "Rigid Box", "Foldable Box", "Sleeve", "Pouch", "Tag/Label", "Other"]
            },
            product: [
                { id: "p1", text: "Product description", type: "text" },
                { id: "p2", text: "Quantity needed", type: "text" },
                { id: "p3", text: "Target price", type: "text" },
                { id: "p4", text: "Delivery date (MMDDYY)", type: "text" },
                { id: "p5", text: "Delivery location", type: "text" }
            ],
            bag: [
                { id: "bag1", text: "Bag material", type: "single", options: ["Paper", "Fabric", "Recycled", "Other"] },
                { id: "bag2", text: "Handle type", type: "single", options: ["Ribbon", "Rope", "Die-cut", "None"] },
                { id: "bag3", text: "Size (L√óW√óH)", type: "text" },
                { id: "bag4", text: "Quantity", type: "text" },
                { id: "bag5", text: "Target price", type: "text" }
            ]
        };

        // Initialize
        function startBrief() {
            state = {
                branch: [],
                packagingTypes: [],
                answers: [],
                queue: [],
                step: 0,
                startedAt: new Date().toISOString()
            };
            buildQueue();
            showScreen("questions");
            renderQuestion();
            initSpeech();
        }

        function buildQueue() {
            state.queue = [QUESTIONS.entry];
        }

        function expandQueue() {
            let q = [QUESTIONS.entry];
            
            if (state.branch.includes("Packaging")) {
                q.push(QUESTIONS.pkgTypes);
                if (state.packagingTypes.includes("Shopping Bag")) {
                    q.push(...QUESTIONS.bag);
                }
            }
            
            if (state.branch.includes("Product")) {
                q.push(...QUESTIONS.product);
            }
            
            state.queue = q;
        }

        // Rendering
        function renderQuestion() {
            const q = state.queue[state.step];
            if (!q) {
                showScreen("complete");
                stopMic();
                return;
            }

            document.getElementById("questionText").textContent = q.text;
            document.getElementById("progress").textContent = `Step ${state.step + 1} of ${state.queue.length}`;
            document.getElementById("answerInput").value = "";
            document.getElementById("nextBtn").disabled = true;

            const choicesArea = document.getElementById("choicesArea");
            choicesArea.innerHTML = "";

            if (q.options) {
                q.options.forEach(opt => {
                    const btn = document.createElement("button");
                    btn.className = "choice-btn";
                    btn.textContent = opt;
                    btn.onclick = () => toggleChoice(btn, q.type);
                    choicesArea.appendChild(btn);
                });
            }

            checkNextButton();
        }

        function toggleChoice(btn, type) {
            if (type === "single") {
                document.querySelectorAll(".choice-btn").forEach(b => b.classList.remove("selected"));
                btn.classList.add("selected");
            } else {
                btn.classList.toggle("selected");
            }
            checkNextButton();
        }

        function getSelectedChoices() {
            return Array.from(document.querySelectorAll(".choice-btn.selected"))
                .map(b => b.textContent);
        }

        function checkNextButton() {
            const hasChoices = getSelectedChoices().length > 0;
            const hasText = document.getElementById("answerInput").value.trim().length > 0;
            document.getElementById("nextBtn").disabled = !(hasChoices || hasText);
        }

        document.getElementById("answerInput").addEventListener("input", checkNextButton);

        // Navigation
        function goNext() {
            const q = state.queue[state.step];
            const choices = getSelectedChoices();
            const notes = document.getElementById("answerInput").value.trim();

            if (!choices.length && !notes) return;

            state.answers.push({
                id: q.id,
                question: q.text,
                choices,
                notes
            });

            if (q.id === "entry") {
                state.branch = choices;
                expandQueue();
            }

            if (q.id === "pkgTypes") {
                state.packagingTypes = choices;
                expandQueue();
            }

            state.step++;
            renderQuestion();
        }

        function goBack() {
            if (state.step > 0) {
                state.step--;
                renderQuestion();
            }
        }

        function skipQuestion() {
            const q = state.queue[state.step];
            state.answers.push({
                id: q.id,
                question: q.text,
                choices: ["Skipped"],
                notes: ""
            });
            state.step++;
            renderQuestion();
        }

        // Speech Recognition
        function initSpeech() {
            const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SR) {
                showBanner("‚ö†Ô∏è Voice recognition not available. Use Chrome, Edge, or Safari.");
                document.getElementById("micBtn").disabled = true;
                return;
            }

            recognition = new SR();
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onresult = (e) => {
                let final = "";
                for (let i = e.resultIndex; i < e.results.length; i++) {
                    if (e.results[i].isFinal) {
                        final += e.results[i][0].transcript + " ";
                    }
                }

                if (final) {
                    const lower = final.toLowerCase();
                    if (/\b(next|continue)\b/.test(lower) && !document.getElementById("nextBtn").disabled) {
                        goNext();
                        return;
                    }
                    if (/\bback\b/.test(lower)) { goBack(); return; }
                    if (/\bskip\b/.test(lower)) { skipQuestion(); return; }
                    if (/\bstop recording\b/.test(lower)) { stopMic(); return; }

                    const input = document.getElementById("answerInput");
                    input.value = (input.value + " " + final).trim();
                    checkNextButton();
                }
            };

            recognition.onerror = (e) => {
                console.error("Speech error:", e.error);
            };

            recognition.onend = () => {
                if (isListening) {
                    try { recognition.start(); } catch(e) {}
                }
            };
        }

        function toggleMic() {
            if (isListening) stopMic();
            else startMic();
        }

        function startMic() {
            if (!recognition) return;
            try {
                recognition.start();
                isListening = true;
                document.getElementById("micDot").classList.add("active");
                document.getElementById("micStatus").textContent = "Recording";
                document.getElementById("micBtn").textContent = "Stop Recording";
            } catch(e) {}
        }

        function stopMic() {
            if (!recognition) return;
            try {
                recognition.stop();
                isListening = false;
                document.getElementById("micDot").classList.remove("active");
                document.getElementById("micStatus").textContent = "Mic Off";
                document.getElementById("micBtn").textContent = "Start Recording";
            } catch(e) {}
        }

        // Export
        function exportJSON() {
            const data = JSON.stringify({
                startedAt: state.startedAt,
                finishedAt: new Date().toISOString(),
                branch: state.branch,
                packagingTypes: state.packagingTypes,
                answers: state.answers
            }, null, 2);

            const blob = new Blob([data], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `lrparis_brief_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportPDF() {
            let content = "LR PARIS BRIEF\n\n";
            content += `Generated: ${new Date().toLocaleString()}\n`;
            content += `Brief Type: ${state.branch.join(", ")}\n\n`;
            content += "=".repeat(60) + "\n\n";

            state.answers.forEach((a, i) => {
                content += `${i + 1}. ${a.question}\n`;
                if (a.choices.length) content += `   ${a.choices.join(", ")}\n`;
                if (a.notes) content += `   ${a.notes}\n`;
                content += "\n";
            });

            const w = window.open("", "_blank");
            w.document.write(`<pre style="font-family:system-ui;padding:40px;max-width:800px;margin:0 auto;">${content}</pre>`);
            w.document.close();
            setTimeout(() => w.print(), 500);
        }

        function startOver() {
            if (confirm("Start over? All progress will be lost.")) {
                location.reload();
            }
        }

        // Utilities
        function showScreen(name) {
            document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
            document.getElementById(name).classList.add("active");
        }

        function showBanner(msg) {
            document.getElementById("bannerArea").innerHTML = `<div class="banner">${msg}</div>`;
        }
    </script>
</body>
</html>